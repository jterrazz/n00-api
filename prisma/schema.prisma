generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Country {
  GLOBAL
  US
  FR
}

enum Language {
  EN
  FR
}

enum Category {
  POLITICS
  BUSINESS
  TECHNOLOGY
  SCIENCE
  HEALTH
  ENVIRONMENT
  SOCIETY
  ENTERTAINMENT
  SPORTS
  OTHER
}

enum Classification {
  STANDARD
  NICHE
  PENDING_CLASSIFICATION
  ARCHIVED
}

model Report {
  id             String         @id @default(uuid())
  facts          String
  categories     Json // Array of Category enum values
  traits         Json // Content traits: { smart: boolean, uplifting: boolean }
  classification Classification @default(PENDING_CLASSIFICATION)

  // Geographic and temporal context
  country  Country
  dateline DateTime

  // Sources
  sources Json

  // Relations
  angles   ReportAngle[]
  articles Article[]     @relation("ReportArticles")

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([country])
  @@index([dateline])
  @@index([createdAt])
}

model ReportAngle {
  id     String @id @default(uuid())
  corpus String

  // Relations
  report   Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
  reportId String

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([reportId])
}

model Article {
  id               String   @id @default(uuid())
  headline         String
  body             String // Main neutral article presenting only facts from all sides
  categories       Json // Array of Category enum values  
  traits           Json // Content traits: { smart: boolean, uplifting: boolean }
  fabricated       Boolean  @default(false) // Whether the article is fabricated
  fabricatedReason String? // Explanation when article is fabricated
  country          Country
  language         Language
  publishedAt      DateTime // When the original report was published
  createdAt        DateTime @default(now())

  // Relations
  frames        ArticleFrame[]
  quizQuestions ArticleQuiz[]
  reports       Report[]       @relation("ReportArticles")

  @@index([language, country])
  @@index([createdAt])
  @@index([publishedAt])
}

model ArticleFrame {
  id       String @id @default(uuid())
  headline String // Frame headline from this viewpoint
  body     String // Viewpoint-specific content explaining this side of the report

  // Relations
  article   Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  articleId String

  // Metadata
  createdAt DateTime @default(now())

  @@index([articleId])
}

model ArticleQuiz {
  id                 String @id @default(uuid())
  question           String // The quiz question text
  answers            Json // Array of possible answers ["Answer 1", "Answer 2", "Answer 3", "Answer 4"]
  correctAnswerIndex Int // Index (0-based) of the correct answer in the answers array

  // Relations
  article   Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  articleId String

  // Metadata
  createdAt DateTime @default(now())

  @@index([articleId])
  @@map("ArticleQuizQuestion")
}
