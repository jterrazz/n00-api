generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Country {
  GLOBAL
  US
  FR
}

enum Language {
  EN
  FR
}

enum Category {
  POLITICS
  BUSINESS
  TECHNOLOGY
  SCIENCE
  HEALTH
  ENVIRONMENT
  SOCIETY
  ENTERTAINMENT
  SPORTS
  OTHER
}

enum Stance {
  SUPPORTIVE
  CRITICAL
  NEUTRAL
  MIXED
  CONCERNED
  OPTIMISTIC
  SKEPTICAL
}

enum Classification {
  STANDARD
  NICHE
  PENDING_CLASSIFICATION
  ARCHIVED
}

enum AuthenticityStatus {
  AUTHENTIC
  FABRICATED
}

model Report {
  id             String         @id @default(uuid())
  facts          String
  categories     Json // Array of Category enum values
  classification Classification @default(PENDING_CLASSIFICATION)

  // Geographic and temporal context
  country  Country
  dateline DateTime

  // Sources
  sources Json

  // Relations
  angles   ReportAngle[]
  articles Article[]     @relation("ReportArticles")

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([country])
  @@index([dateline])
  @@index([createdAt])
}

model ReportAngle {
  id     String  @id @default(uuid())
  corpus String
  stance Stance?

  // Relations
  report   Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
  reportId String

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([reportId])
  @@index([stance])
}

model Article {
  id            String             @id @default(uuid())
  headline      String
  body          String // Main neutral article presenting only facts from all sides
  categories    Json // Array of Category enum values  
  authenticity  AuthenticityStatus @default(AUTHENTIC) // Whether the article is authentic or fabricated
  clarification String? // Explanation when authenticity is FABRICATED
  country       Country
  language      Language
  publishedAt   DateTime // When the original report was published
  createdAt     DateTime           @default(now())

  // Relations
  frames  ArticleFrame[]
  reports Report[]       @relation("ReportArticles")

  @@index([language, country])
  @@index([createdAt])
  @@index([publishedAt])
}

model ArticleFrame {
  id       String @id @default(uuid())
  headline String // Frame headline from this viewpoint
  body     String // Viewpoint-specific content explaining this side of the report
  stance   Stance // The viewpoint/stance this frame represents

  // Relations
  article   Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  articleId String

  // Metadata
  createdAt DateTime @default(now())

  @@index([articleId])
  @@index([stance])
}
